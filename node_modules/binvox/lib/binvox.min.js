!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).BINVOX={})}(this,(function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}var s=function(){function e(){t(this,e),this.dimension={},this.translation={},this.scale=1,this.voxels=[],this.index=0}return n(e,[{key:"parse",value:function(e){return this._parseHeader(e),this._parseVoxelData(e),{dimension:this.dimension,translate:this.translation,scale:this.scale,voxels:this.voxels}}},{key:"_parseHeader",value:function(e){for(var t=new TextDecoder("ascii"),i=!0,n=[],s=this.index,r="";i;){var a=t.decode(e.slice(s,s+1));"\n"===a?(n.push(r),r=""):r+=a,("Data"===r||n.length>=5)&&(i=!1),s++}this.index=s;var o=n[0],h=n[1],l=n[2],d=n[3],u=n[4];if("#binvox 1"!==o)throw new Error('First line reads "'+o+'" instead of "#binvox"');var f=h.split(" ");if("dim"!==f[0])throw new Error("Error reading dimension line");this.dimension={depth:parseInt(f[1]),width:parseInt(f[2]),height:parseInt(f[3])};var v=l.split(" ");if("translate"!==v[0])throw new Error("Error reading translate line");this.translation={depth:parseFloat(v[1]),width:parseFloat(v[2]),height:parseFloat(v[3])};var c=d.split(" ");if("scale"!==c[0])throw new Error("Error reading scale line");if(this.scale=parseFloat(c[1]),"data"!==u)throw new Error("Error reading header")}},{key:"_parseVoxelData",value:function(e){for(var t=new Uint8Array(e,this.index),i=0,n=0,s=0,r=0;i<t.length;){for(var a=t[i],o=t[i+1],h=0;h<o;h++){if(1===a){var l={x:r,y:n,z:s};this.voxels.push(l)}++n===this.dimension.width&&(n=0,s++),s===this.dimension.height&&(s=0,r++)}i+=2}}}]),e}(),r=function(){function e(){t(this,e),this.dimension={},this.translation={},this.scale=1,this.voxels=[]}return n(e,[{key:"build",value:function(e){this.dimension=e.dimension,this.translation=e.translate,this.scale=e.scale,this.voxels=e.voxels;var t=this._generateHeader(),i=this._generateVoxelData(),n=new Uint8Array(t.length+i.length);return n.set(t),n.set(i,t.length),n.buffer}},{key:"_generateHeader",value:function(){var e=new TextEncoder("ascii"),t="";return t+="#binvox 1\n",t+="dim "+[this.dimension.depth,this.dimension.width,this.dimension.height].join(" ")+"\n",t+="translate "+[this.translation.depth,this.translation.width,this.translation.height].join(" ")+"\n",t+="scale "+this.scale+"\n",t+="data\n",e.encode(t)}},{key:"_generateVoxelData",value:function(){var e,t=0,i=0;e=0===this.voxels[0].x&&0===this.voxels[0].y&&0===this.voxels[0].z?1:0;for(var n=[],s=0;s<this.dimension.depth;s++)for(var r=0;r<this.dimension.height;r++)for(var a=0;a<this.dimension.width;a++){var o=0;void 0!==this.voxels[t]&&this.voxels[t].x===s&&this.voxels[t].y===a&&this.voxels[t].z===r&&(t++,o=1),o===e?255===++i&&(n.push(e,i),i=0):(n.push(e,i),e=o,i=1)}return i>0&&n.push(e,i),new Uint8Array(n)}}]),e}();e.Builder=r,e.Parser=s,Object.defineProperty(e,"__esModule",{value:!0})}));
